# 🧹 CleanUpDeb

Лёгкая bash-утилита для очистки системы Debian 13 (Trixie)

## 🚀 Возможности

CleanUpDeb — это простая в использовании утилита для автоматизации процесса очистки системы Debian. Скрипт выполняет следующие этапы очистки:

1. **Поиск крупных файлов** — находит топ-30 самых больших файлов на диске (порог настраивается, по умолчанию ≥100 МБ)
2. **Очистка APT-кеша** — удаляет устаревшие пакеты из `/var/cache/apt/archives` с помощью `apt-get clean` и `autoclean`
3. **Удаление неиспользуемых пакетов** — убирает зависимости, которые больше не нужны (`apt-get autoremove --purge`)
4. **Очистка временных файлов** — удаляет файлы старше 7 дней в каталогах `/tmp` и `/var/tmp`
5. **Очистка пользовательского кеша** — удаляет файлы старше 30 дней из `~/.cache/*` для всех пользователей
6. **Очистка журналов systemd** — сокращает размер журналов с помощью `journalctl --vacuum-time` (по умолчанию до 7 дней)
7. **Очистка архивных логов** — удаляет сжатые и старые лог-файлы (`*.gz`, `*.old`, `*.1`) из `/var/log`
8. **Очистка миниатюр** — удаляет кеш превью изображений из `~/.cache/thumbnails`
9. **Очистка корзины** — очищает содержимое корзины для всех пользователей из `~/.local/share/Trash`

## 📋 Требования

- **Операционная система**: Debian 13 (Trixie) или совместимый дистрибутив (Ubuntu, Linux Mint и др.)
- **Bash**: версия 5.0 или выше
- **Права доступа**: требуется запуск с правами root (через `sudo`)
- **Утилиты**: стандартный набор GNU-утилит (`find`, `du`, `numfmt`, `apt-get`, `journalctl`)

## 📦 Установка

### Вариант 1: Клонирование репозитория

```bash
# Клонировать репозиторий
git clone https://github.com/leonidSpiri/CleanUpDeb.git

# Перейти в каталог
cd CleanUpDeb

# Сделать скрипт исполняемым (если ещё не выполнено)
chmod +x cleanup.sh
```

### Вариант 2: Установка в систему (опционально)

```bash
# Скопировать скрипт в системный каталог для исполняемых файлов
sudo cp cleanup.sh /usr/local/bin/cleanup

# Теперь можно запускать из любого места
sudo cleanup --help
```

## 🎯 Использование

### Основные команды

```bash
# Режим отчёта (dry-run) — только показывает, что будет сделано, НЕ удаляет файлы
sudo ./cleanup.sh

# Реальная очистка — выполняет удаление файлов
sudo ./cleanup.sh --apply

# Показать справку
./cleanup.sh --help
```

### Примеры с параметрами

```bash
# Поиск файлов больше 500 МБ перед очисткой
sudo ./cleanup.sh --threshold 500M

# Поиск файлов больше 1 ГБ и выполнение очистки
sudo ./cleanup.sh --threshold 1G --apply

# Поиск крупных файлов только в домашних каталогах
sudo ./cleanup.sh --search-dir /home

# Хранить журналы не старше 3 дней
sudo ./cleanup.sh --journal-age 3d --apply

# Хранить журналы не старше 2 недель
sudo ./cleanup.sh --journal-age 2w --apply

# Комбинированный пример: поиск файлов > 200M в /home, журналы 5 дней, с очисткой
sudo ./cleanup.sh --threshold 200M --search-dir /home --journal-age 5d --apply
```

## 📖 Таблица опций

| Опция | Описание | Значение по умолчанию |
|-------|----------|-----------------------|
| `--apply` | Выполнить реальную очистку (без этого флага работает в режиме отчёта) | `false` (dry-run) |
| `--threshold РАЗМЕР` | Порог для определения крупного файла (например: `50M`, `1G`, `500M`) | `100M` |
| `--search-dir ПУТЬ` | Каталог для поиска крупных файлов | `/` (весь диск) |
| `--journal-age СРОК` | Максимальный возраст журналов systemd (например: `3d`, `2w`, `1m`) | `7d` (7 дней) |
| `-h`, `--help` | Показать справку по использованию утилиты | — |

## 🔍 Таблица этапов очистки

| № | Этап | Описание | Автоматическое удаление |
|---|------|----------|-------------------------|
| 1 | Поиск крупных файлов | Находит топ-30 самых больших файлов выше порога | ❌ Нет (только отчёт) |
| 2 | Очистка APT-кеша | Удаляет кеш установочных пакетов Debian/Ubuntu | ✅ Да (с `--apply`) |
| 3 | Удаление неиспользуемых пакетов | Удаляет пакеты-зависимости, которые больше не нужны | ✅ Да (с `--apply`) |
| 4 | Очистка временных файлов | Удаляет файлы старше 7 дней из `/tmp` и `/var/tmp` | ✅ Да (с `--apply`) |
| 5 | Очистка пользовательского кеша | Удаляет файлы старше 30 дней из `~/.cache` | ✅ Да (с `--apply`) |
| 6 | Очистка журналов systemd | Сокращает размер системных журналов до указанного срока | ✅ Да (с `--apply`) |
| 7 | Очистка архивных логов | Удаляет сжатые и ротированные логи из `/var/log` | ✅ Да (с `--apply`) |
| 8 | Очистка миниатюр | Удаляет кеш превью изображений | ✅ Да (с `--apply`) |
| 9 | Очистка корзины | Очищает корзину всех пользователей | ✅ Да (с `--apply`) |

## 🛡️ Безопасность

CleanUpDeb разработан с учётом безопасности:

- **Dry-run по умолчанию** — без флага `--apply` скрипт только показывает отчёт и не удаляет файлы
- **Крупные файлы не удаляются** — скрипт только находит и показывает их, решение об удалении принимает пользователь вручную
- **Детальное логирование** — каждый запуск сохраняется в `/tmp/cleanup_YYYYMMDD_HHMMSS.log`
- **Безопасный режим Bash** — использует `set -euo pipefail` для остановки при ошибках
- **Исключение системных каталогов** — поиск файлов автоматически пропускает `/proc`, `/sys`, `/dev`, `/run`
- **Проверка прав root** — скрипт проверяет наличие необходимых прав перед началом работы
- **Безопасное удаление** — используются защищённые конструкции (например, `${dir:?}` для предотвращения случайного удаления корня)
- **Цветной вывод** — понятная цветовая индикация (зелёный — успех, жёлтый — предупреждение, красный — ошибка)

## 💡 Пример вывода

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  🧹 Утилита очистки системы — Debian 13
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Дата запуска : 2026-02-17 14:30:00
  Режим        : ОТЧЁТ (dry-run)
  Порог файлов : 100M
  Лог          : /tmp/cleanup_20260217_143000.log

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  1️⃣  Поиск крупных файлов (≥ 100M)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Поиск в / (исключая /proc, /sys, /dev, /run)...

  Топ крупных файлов:
  ─────────────────────────────────────────────────
  1.5GiB    /var/log/syslog.1
  850MiB    /home/user/Downloads/ubuntu.iso
  320MiB    /var/cache/apt/archives/linux-image.deb

  ℹ Крупные файлы не удаляются автоматически — проверьте вручную.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  2️⃣  Очистка APT-кеша
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Текущий размер: 245MiB
  ↳ [dry-run] apt-get clean / autoclean

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  3️⃣  Удаление неиспользуемых пакетов (autoremove)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  Пакетов к удалению: 12
  ↳ [dry-run] apt-get autoremove --purge

...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  📊 Итоговый отчёт
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  Диск (/) до очистки  : 25.3GiB занято
  Диск (/) после       : 25.3GiB занято

  ⚠  Режим отчёта — ничего не удалено.
     Запустите с флагом --apply для реальной очистки.

  Полный лог сохранён: /tmp/cleanup_20260217_143000.log
```

## 📄 Лицензия

Этот проект распространяется под лицензией MIT. Вы можете свободно использовать, модифицировать и распространять этот скрипт.

---

**Автор**: GitHub Copilot  
**Дата создания**: 2026-02-17  
**Версия**: 1.0.0
